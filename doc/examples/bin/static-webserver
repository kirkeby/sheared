#!/usr/bin/env python

import sys

from sheared import reactor
from sheared.web import server

try:
    address, port, docroot = sys.argv[1:]
except ValueError:
    sys.stderr.write('Usage: %s address port docroot\n' % sys.argv[0])
    sys.exit(1)

try:
    collection = server.StaticCollection(reactor, docroot)
    server = server.HTTPServerFactory(reactor, server.HTTPServer)
    server.addVirtualHost('localhost', collection)
    server.setDefaultHost('localhost')
    reactor.listenTCP(server, (address, int(port)))
    reactor.run()
except:
    import traceback
    apply(traceback.print_exception, sys.exc_info())
