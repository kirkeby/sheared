#!/usr/bin/env python

import sys, os

from sheared import reactor
from sheared.web import server

try:
    factory = server.HTTPServerFactory(reactor, server.HTTPSubServer)
    factory.addVirtualHost('localhost', server.StaticCollection(reactor, sys.argv[2]))
    try:
        os.unlink(sys.argv[1])
    except:
        pass
    reactor.listenUNIX(factory, sys.argv[1])
    reactor.run()

except:
    import traceback
    apply(traceback.print_exception, sys.exc_info())

