#!/usr/bin/env python

import unittest, sys, traceback, os

sys.path.insert(0, 'test')

os.system('python setup.py build')
for path in os.listdir('build'):
    if path.startswith('lib.'):
        sys.path.insert(0, 'build/' + path)
        break
else:
    raise 'No build/lib.$ARCH found.'

if len(sys.argv) == 1:
    import tests
    tests = tests.__all__
else:
    tests = sys.argv[1:]
    
runner = unittest.TextTestRunner()
for test in tests:
    module = __import__('tests.%s' % test, globals(), locals(), (test,))
    if getattr(module, 'skip', 0):
        print "Skipping tests in %s" % module
    else:
        print "Running tests in %s" % module
        runner.run(module.suite)
